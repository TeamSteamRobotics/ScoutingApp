<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Team 5119 Scouting App</title>
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./main.css">
    <script>
        require("./renderer.js");
        const fs = require('fs');
        const QRCode = require('qrcode');

        $(document).ready(function() {
            if (fs.existsSync('savedData.json')) {
                fs.readFile('savedData.json', (err, rawData) => {
                    if (err) throw err;
                    let data = JSON.parse(rawData);
                    $.each(data, function(key, value){
                        console.log(key + '\t' + value);
                        $('#' + key).val(value);
                    });
                });
            }
        });

        function makeJSON() {
            //Before you read this next bit of code and decide you hate me forever, see if you could do it better yourself. If you can, make a PR. - @amrelk
            let matchForm = $('#matchForm')[0];
            let matchData = {};
            for (let i = 0; i < matchForm.length; i++){
                console.log(matchForm[i].id + '\t:\t' + matchForm[i].value);
                matchData[matchForm[i].id] = matchForm[i].value;
            }
            return matchData
        }

        function saveJSON() {
            fs.writeFile('savedData.json', JSON.stringify(makeJSON(), null, 2), (err) => {if (err) throw err;});
        }

        function makeQR() {
            QRCode.toCanvas($('#qrCanvas')[0], JSON.stringify(makeJSON()))
        }
    </script>
</head>
<body>
<div class="container-fluid">
    <!-- QR Code Modal -->
    <div class="modal fade" id="qrModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="qrModalLabel">QR</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row justify-content-center">
                            <div class="col-auto">
                                <canvas id="qrCanvas"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- the match form -->
    <form id="matchForm">
        <div class="form-row">
            <div class="form-group col-4">
                <label for="inputYourName">Name</label>
                <input type="text" class="form-control" id="inputYourName" placeholder="Your Name">
            </div>
            <div class="form-group col-3">
                <label for="inputTeamNumber">Team Number</label>
                <input type="text" class="form-control" id="inputTeamNumber" placeholder="1763">
            </div>
            <div class="form-group col-5">
                <label for="inputMatches">Matches</label>
                <input type="text" class="form-control" id="inputMatches" placeholder="7,10,14,38,...">
            </div>
        </div>
    </form>
    <div class="row">
        <div class="col">
            <button class="btn btn-block btn-outline-secondary" onclick="saveJSON()">save data</button>
        </div>
        <div class="col">
            <button class="btn btn-block btn-outline-primary" onclick="makeQR()" data-toggle="modal" data-target="#qrModal">generate QR</button>
        </div>
    </div>
</div>
</body>
</html>